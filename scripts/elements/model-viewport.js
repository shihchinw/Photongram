var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},__decorate=this&&this.__decorate||function(e,t,r,i){var o,n=arguments.length,a=3>n?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(3>n?o(a):n>3?o(t,r,a):o(t,r))||a);return n>3&&a&&Object.defineProperty(t,r,a),a},ModelViewport=function(e){function t(){e.call(this),this.visible=!1,this.visible=!1,this.gltfLoader=new THREE.glTFLoader,this.materialList={}}return __extends(t,e),t.prototype.ready=function(){this._initRenderer(),this.scene=new THREE.Scene,this._setupScene(this.scene)},t.prototype._initRenderer=function(){var e=300,t=300;this.renderer=new THREE.WebGLRenderer({alpha:!0}),this.renderer.setSize(e,t),this.renderer.setClearColor(0,0),this.appendChild(this.renderer.domElement);var r=new THREE.Vector3(10,10,10);this.camera=new THREE.PerspectiveCamera(75,e/t,.1,1e3),this.camera.position.set(r.x,r.y,r.z),this.camera.lookAt(new THREE.Vector3(0,0,0)),this.cameraControl=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.cameraControl.enablePan=!1,this.cameraControl.addEventListener("change",this.renderJob.bind(this))},t.prototype._setupScene=function(e){var t=new THREE.ShaderMaterial(THREE.ShaderLib.basic),r=new THREE.Mesh(new THREE.SphereGeometry(5,64,64,0,2*Math.PI,0,Math.PI),t);this.model=r,this.scene.add(r)},t.prototype.addMaterial=function(e,t){var r=pgLib[e],i=JSON.parse(JSON.stringify(modelMaterial));i.uniforms=THREE.UniformsUtils.merge([modelMaterial.uniforms,r.uniforms]),i.fragmentShader=i.fragmentShader.replace("{{PHASE_FUNCTION}}",r.brdf);var o=new THREE.ShaderMaterial(i),n=new THREE.DirectionalLight;o.uniforms.uLightPos.value=n.position,this.materialList[t]=o},t.prototype.removeMaterial=function(e){this.materialList[e];this.model.material=void 0,delete this.materialList[e],0===Object.keys(this.materialList).length&&(this.model.material=new THREE.ShaderMaterial(THREE.ShaderLib.basic)),this.renderJob()},t.prototype.updateShaderParam=function(e){var t=this.materialList[e.uuid],r=e.name;t&&r in t.uniforms&&(t.uniforms[r].value=e.value,this.renderJob())},t.prototype.changeShader=function(e){this.materialList.hasOwnProperty(e)&&(this.model.material=this.materialList[e],this.renderJob())},t.prototype._adjustCameraFocus=function(e){e.center();var t=e.boundingBox.max;this.camera.position.copy(t.multiplyScalar(2))},t.prototype.changeModel=function(e){if("sphere"===e){var t=this.model.material;this.scene.remove(this.model);var r=new THREE.Mesh(new THREE.SphereGeometry(5,64,64,0,2*Math.PI,0,Math.PI),t);this._adjustCameraFocus(r.geometry),this.model=r,this.scene.add(r),this.renderJob()}else this.fire("toogle-spinner",!0),this.gltfLoader.load("assets/obj/"+e+".gltf",this._onModelLoaded.bind(this))},t.prototype._onModelLoaded=function(e){var t=this.model.material;this.scene.remove(this.model),e.scene.traverse(function(e){e instanceof THREE.Mesh&&(this.model=e,this.model.material=t,this.scene.add(e),this._adjustCameraFocus(e.geometry))}.bind(this)),this.fire("toogle-spinner",!1),this.renderJob()},t.prototype.renderJob=function(){this.debounce("model-viewport-render-job",function(){requestAnimationFrame(this._render.bind(this))},1)},t.prototype._render=function(){this.visible&&(this.cameraControl.update(),this.renderer.render(this.scene,this.camera))},t.prototype._resize=function(){var e=this.clientWidth,t=this.clientHeight;this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t),this.renderJob()},t.prototype.changeLightDir=function(e){var t=this.model.material;t.uniforms.hasOwnProperty("uLightPos")&&(t.uniforms.uLightPos.value=e),this.renderJob()},__decorate([property({observer:"renderJob"})],t.prototype,"visible",void 0),__decorate([listen("iron-resize")],t.prototype,"_resize",null),t=__decorate([component("model-viewport"),behavior(Polymer.IronResizableBehavior)],t)}(polymer.Base);ModelViewport.register();